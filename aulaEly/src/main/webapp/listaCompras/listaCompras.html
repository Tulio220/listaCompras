<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Lista de Compras</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
   <style>
	body {
	    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
	    background-color: #f8f9fa;
	    margin: 0;
	    padding: 0;
	}
	
	.header-container {
	    display: flex;
	    justify-content: center;
	    align-items: center;
	    gap: 20px;
	    margin-top: 50px;
	    margin-bottom: 40px;
	}
	
	.header-logo {
	    text-align: center;
	}
	
	.header-title {
	    font-size: 2.5rem; 
	    font-weight: 700; 
	    color: #2c3e50; 
	    text-transform: uppercase; 
	    letter-spacing: 2px; 
	    position: relative;
	    display: inline-block;
	    padding-bottom: 10px;
	    text-align: center;
	    transition: color 0.3s ease, transform 0.3s ease; 
	}
	
	.header-title::after {
	    content: "";
	    position: absolute;
	    bottom: 0;
	    left: 0;
	    width: 50%;
	    height: 3px; 
	    background-color: #3498db; 
	    border-radius: 5px;
	}
	
	.header-title:hover {
	    color: #3498db; 
	    cursor: pointer;
	}
	
	.header-title:hover::after {
	    width: 100%;
	    transform: translateY(-5px); 
	}
	
	.header-title i {
	    margin-right: 15px; 
	    font-size: 2.5rem;
	    color: #3498db;
	    transition: transform 0.3s ease; 
	    animation: moveCart 2s ease-in-out infinite; 
	}
	
	@keyframes moveCart {
	    0% {
	        transform: translateX(0); 
	    }
	    50% {
	        transform: translateX(-5px); 
	    }
	    100% {
	        transform: translateX(0);
	    }
	}
	
	.header-title:hover i {
	    transform: scale(1.2); 
	}
	
	@media (max-width: 768px) {
	    .header-container {
	        flex-direction: column; 
	        gap: 20px;
	    }
	
	    .header-title {
	        font-size: 2rem; 
	    }
	
	    .header-title i {
	        font-size: 2rem; 
	    }
	}	   
	   
    .container {
        background-color: #fff;
        padding: 40px;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        margin-top: 30px;
        max-width: 1200px;
        margin-left: auto;
        margin-right: auto;
    }

    h2 {
        color: #333;
        font-size: 2rem;
        font-weight: 600;
        text-align: center;
        margin-bottom: 30px;
    }

    .btn {
        font-weight: bold;
        border-radius: 5px;
        padding: 10px 20px;
        transition: transform 0.2s ease-in-out, background-color 0.3s ease;
    }

    .btn-primary {
        background-color: #8e9aaf; 
        border: none;
    }

    .btn-primary:hover {
        background-color: #7a869a;
        transform: translateY(-4px);
    }

    .btn-danger {
        border: none;
        transition: background-color 0.3s ease, transform 0.2s ease-in-out;
    }

    .btn-danger:hover {
        background-color: #f5c6cb;
        transform: translateY(-4px); 
    }

    .modal-content {
        border-radius: 8px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .modal-header {
        background-color: #f8f9fa;
        color: #333;
        border-bottom: 2px solid #ddd;
        padding: 20px;
        font-weight: bold;
        text-align: center;
        font-size: 1.6rem;
    }

    .modal-body input {
        border-radius: 5px;
        padding: 10px;
        width: 100%;
        border: 1px solid #ddd;
        margin-bottom: 15px;
    }

    .table {
        margin-top: 30px;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        background-color: #fff;
        font-size: 1.1rem;
    }

    .table th, .table td {
        padding: 15px;
        text-align: center;
        font-size: 1.4rem;
    }

    .table th {
        background-color: #8e9aaf; 
        color: #fff; 
        font-weight: 600;
    }

    .table-striped tbody tr:nth-child(odd) {
        background-color: #f9f9f9;
    }

    .table-striped tbody tr:nth-child(even) {
        background-color: #f1f1f1;
    }

    .table-bordered {
        border: 1px solid #ddd;
    }

    .table tbody tr:hover {
        background-color: #e9ecef;
        cursor: pointer;
    }
    #loading {
        position: fixed; 
        top: 50%; 
        left: 50%; 
        transform: translate(-50%, -50%); 
        text-align: center;
        z-index: 9999;
    }

    #loading img {
        width: 100px; 
        height: auto;
    }

    #loading p {
        font-size: 1rem;
        color: #333;
    }
    
    h2 {
	  font-size: 2rem;
	  font-weight: bold; 
	  color: #2c3e50; 
	  text-align: center; 
	  margin-bottom: 20px;
	  text-transform: uppercase; 
	  letter-spacing: 1.5px;
	  border-bottom: 2px solid #3498db; 
	  padding-bottom: 5px; 
	} 			
	
	#searchInput {
	    width: 125%; 
	    max-width: 500px; 
	    border-radius: 25px; 
	    transition: all 0.3s ease; 
	}
	
	#searchInput:focus {
	    border-color: #007bff; 
	    box-shadow: 0 0 5px rgba(0, 123, 255, 0.5); 
	}
	
        .input-group {
            width: 75%;
        }
        .input-group-text {
            position: absolute;
            z-index: 2; 
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #888;
            font-size: 16px;
        }
        .form-control {
            padding-right: 30px;
        }
</style>
   
   
</head>
<body onload="carregarItens()">
    <div class="container">
       <div class="header-container">
		    <div class="header-logo">
		        <h2 class="header-title">
		            <i class="fas fa-shopping-cart"></i> Lista de Compras
		        </h2>
		    </div>
		</div>    
        
        <div class="col-md-2">
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#addItemModal">Adicionar Item</button>        
        </div>
        
        <div class="col-md-7">
        
        </div>
					
		 <div class="caixaPesquisa">
        <div class="form-group col-md-3">
            <div class="input-group">
                <input type="text" class="form-control" id="searchInput" placeholder="Pesquise..." onkeyup="searchItems()">
                <div class="input-group-append">
                </div>
            </div>
            <!-- Ícone da lupa -->
            <span class="input-group-text">
                <i class="fas fa-search"></i>
            </span>
        </div>						
		         
        <table class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nome</th>
                    <th>Quantidade</th>
                    <th>Categoria</th>
                    <th>Prioridade</th>
                    <th>Mercado</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody id="tableBody">
            </tbody>
        </table>

        <div id="loading">
            <img src="https://i.imgur.com/llF5iyg.gif" alt="Carregando...">
            <p>Carregando itens...</p>
        </div>
    </div>

    <div id="addItemModal" class="modal fade" tabindex="-1" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Adicionar Item</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="addForm">
                        <div class="form-group">
                            <label for="nome">Nome:</label>
                            <input type="text" class="form-control" id="nome" required>
                        </div>
                        <div class="form-group">
                            <label for="quantidade">Quantidade:</label>
                            <input type="number" class="form-control" id="quantidade" required>
                        </div>
                        <div class="form-group">
                            <label for="categoria">Categoria:</label>
                            <input type="text" class="form-control" id="categoria" required>
                        </div>
                        <div class="form-group">
                            <label for="prioridade">Prioridade:</label>
                            <input type="number" class="form-control" id="prioridade" required>
                        </div>
                        <div class="form-group">
                            <label for="mercado">Mercado:</label>
                            <input type="text" class="form-control" id="mercado" required>
                        </div>
                        <button type="button" class="btn btn-primary" onclick="addItem()">Salvar</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div id="editItemModal" class="modal fade" tabindex="-1" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Editar Item</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="editForm">
                        <input type="hidden" id="editId">
                        <div class="form-group">
                            <label for="editNome">Nome:</label>
                            <input type="text" class="form-control" id="editNome" required>
                        </div>
                        <div class="form-group">
                            <label for="editQuantidade">Quantidade:</label>
                            <input type="number" class="form-control" id="editQuantidade" required>
                        </div>
                        <div class="form-group">
                            <label for="editCategoria">Categoria:</label>
                            <input type="text" class="form-control" id="editCategoria" required>
                        </div>
                        <div class="form-group">
                            <label for="editPrioridade">Prioridade:</label>
                            <input type="number" class="form-control" id="editPrioridade" required>
                        </div>
                        <div class="form-group">
                            <label for="editMercado">Mercado:</label>
                            <input type="text" class="form-control" id="editMercado" required>
                        </div>
                        <button type="button" class="btn btn-primary" onclick="updateItem()">Salvar Alterações</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div id="deleteItemModal" class="modal fade" tabindex="-1" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Confirmar Exclusão</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Tem certeza que deseja excluir este item?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Excluir</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                </div>
            </div>
        </div>
    </div>

</body>
    

    <script>
    
    $('#addItemModal').on('show.bs.modal', function () {
        document.getElementById("addForm").reset();
    });

    let currentItemId = null;

    function carregarItens() {
        console.log('Função carregarItens chamada');
        document.getElementById("loading").style.display = "block";
        
        fetch('../ListaComprasAPI')
        .then(response => {
            if (!response.ok) {
                throw new Error('Erro na resposta da API: ' + response.statusText);
            }
            return response.json();
        })
        .then(data => {
            console.log('Dados recebidos da API:', data);
            const tableBody = document.getElementById("tableBody");
            tableBody.innerHTML = ''; 
            
            data.forEach(item => {
                console.log('Item:', item);
                tableBody.innerHTML += `
                    <tr>
                        <td>${item.idLista}</td>
                        <td>${item.nome}</td>
                        <td>${item.quantidade}</td>
                        <td>${item.categoria}</td>
                        <td>${item.prioridade}</td>
                        <td>${item.mercado}</td>
                        <td>
                            <button class="btn btn-warning" onclick="editItem(${item.idLista})">Editar</button>
                            <button class="btn btn-danger" onclick="confirmDelete(${item.idLista})">Excluir</button>
                        </td>
                    </tr>
                `;
            });
            
            document.getElementById("loading").style.display = "none"; 
        })
        .catch(error => {
            console.error('Erro ao carregar itens:', error);
            alert('Erro ao carregar itens: ' + error.message);
            document.getElementById("loading").style.display = "none";
        });
    }

    function addItem() {
        const nome = document.getElementById("nome").value.trim();
        const quantidade = document.getElementById("quantidade").value.trim();
        const categoria = document.getElementById("categoria").value.trim();
        const prioridade = document.getElementById("prioridade").value.trim();
        const mercado = document.getElementById("mercado").value.trim();

        if (!nome || !quantidade || !categoria || !prioridade || !mercado) {
            alert('Todos os campos devem ser preenchidos!');
            return;
        }

        const item = { nome, quantidade, categoria, prioridade, mercado };
        console.log('Item a ser enviado:', item);

        fetch('../ListaComprasAPI', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(item)
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Erro ao adicionar item: ' + response.statusText);
            }
            return response.json();
        })
        .then(data => {
            console.log('Item adicionado com sucesso:', data);
            carregarItens();
            $("#addItemModal").modal("hide");
        })
        .catch(error => {
            console.error('Erro ao adicionar item:', error);
            alert('Erro ao adicionar item: ' + error.message);
        });
    }

    function editItem(id) {
        fetch(`../ListaComprasAPI/${id}`)
        .then(response => {
            if (!response.ok) {
                throw new Error('Erro ao carregar item para edição: ' + response.statusText);
            }
            return response.json();
        })
        .then(data => {
            currentItemId = data.idLista;
            console.log('Item a ser editado:', data);

            document.getElementById("editNome").value = data.nome;
            document.getElementById("editQuantidade").value = data.quantidade;
            document.getElementById("editCategoria").value = data.categoria;
            document.getElementById("editPrioridade").value = data.prioridade;
            document.getElementById("editMercado").value = data.mercado;

            $("#editItemModal").modal("show");
        })
        .catch(error => {
            console.error('Erro ao carregar item para edição:', error);
            alert('Erro ao carregar item para edição: ' + error.message);
        });
    }

    function updateItem() {
        const nome = document.getElementById("editNome").value.trim();
        const quantidade = document.getElementById("editQuantidade").value.trim();
        const categoria = document.getElementById("editCategoria").value.trim();
        const prioridade = document.getElementById("editPrioridade").value.trim();
        const mercado = document.getElementById("editMercado").value.trim();

        if (!nome || !quantidade || !categoria || !prioridade || !mercado) {
            alert('Todos os campos devem ser preenchidos!');
            return;
        }

        const item = {
            idLista: currentItemId,
            nome,
            quantidade,
            categoria,
            prioridade,
            mercado
        };

        console.log('Dados a serem atualizados:', item);

        fetch('../ListaComprasAPI', {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(item)
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Erro ao atualizar item: ' + response.statusText);
            }
            return response.json();
        })
        .then(data => {
            console.log('Item atualizado com sucesso:', data);
            carregarItens();
            $("#editItemModal").modal("hide");
        })
        .catch(error => {
            console.error('Erro ao atualizar item:', error);
            alert('Erro ao atualizar item: ' + error.message);
        });
    }
    function confirmDelete(id) {
        $('#deleteItemModal').modal('show');
        document.getElementById("confirmDeleteBtn").onclick = function() {
            deleteItem(id);
        };
    }

    function deleteItem(id) {
        console.log('ID do item a ser deletado:', id);

        fetch(`../ListaComprasAPI/${id}`, {
            method: 'DELETE'
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Erro ao excluir item: ' + response.statusText);
            }
            $('#deleteItemModal').modal('hide');
            carregarItens();
        })
        .catch(error => {
            console.error('Erro ao excluir item:', error);
            alert('Erro ao excluir item: ' + error.message);
        });
    }
    
    function searchItems() {
        const searchQuery = document.getElementById('searchInput').value.toLowerCase(); 
        const rows = document.getElementById('tableBody').getElementsByTagName('tr'); 

        for (let i = 0; i < rows.length; i++) {
            const cells = rows[i].getElementsByTagName('td'); 
            let match = false;

            for (let j = 0; j < cells.length; j++) {
                const cellText = cells[j].textContent || cells[j].innerText;
                if (cellText.toLowerCase().indexOf(searchQuery) > -1) {
                    match = true;
                    break;
                }
            }

            if (match) {
                rows[i].style.display = ''; 
            } else {
                rows[i].style.display = 'none'; 
            }
        }
    }

</script>
    
    
    
</body>
</html>
